name: Go Code Review & Build Check

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.24'

      - name: Install dependencies
        run: go mod tidy

      # Lint tekshiruvi (ID berdik)
      - name: Run Linter
        id: lint
        uses: golangci/golangci-lint-action@v6
        with:
          version: latest

      - name: Create dummy .env
        run: cp .env.example .env || touch .env

      # Docker build tekshiruvi (ID berdik)
      - name: Build Docker Image
        id: docker
        run: docker compose build

      # Yagona Telegram xabari
      - name: Send Telegram Notification
        if: always()
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_CHAT_ID }}
          token: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          message: |
            ${{ steps.lint.outcome == 'success' && steps.docker.outcome == 'success' && 'âœ…' || 'âŒ' }} *PassPortierBot Review Result*

            ğŸ” *Linting:* ${{ steps.lint.outcome == 'success' && 'âœ… OK' || 'âŒ Error' }}
            ğŸ³ *Docker Build:* ${{ steps.docker.outcome == 'success' && 'âœ… OK' || 'âŒ Error' }}

            ğŸ‘¤ Muallif: ${{ github.actor }}
            ğŸ“ Commit: ${{ github.event.head_commit.message }}
            
            ğŸ”— [Batafsil ko'rish](https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }})